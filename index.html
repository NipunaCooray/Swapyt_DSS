<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paediatric Splenic Trauma — Decision Support System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --ink: #111827;
      --muted: #5b6b82;
      --card: #ffffff;
      --line: #e6e8ee;
      --brand: #0a66ff;
      --brand-ink: #0a56d0;
      --callout-bg: #fff6e5;
      --callout-border: #ffe1a8;
      --callout-accent: #ff9f1c;
      --callout-ink: #7a5a32;
    }

    body {
      background: #f6f8fb;
      color: var(--ink);
    }

    .app {
      max-width: 1000px;
      margin: 24px auto;
    }

    .header-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
    }

    .badge-dst {
      background: #e8f0ff;
      color: var(--brand-ink);
      border: 1px solid #cfe0ff;
      font-weight: 700;
    }

    .card-step {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      margin-bottom: 1rem;
    }

    .step-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: .75rem;
    }

    .alert-instruction {
      background: #eef3ff;
      border: 1px solid #dbe6ff;
    }

    .sidebar-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
    }

    .muted {
      color: var(--muted);
    }

    .btn-primary {
      background: var(--brand);
      border-color: var(--brand);
    }

    .btn-outline-primary {
      border-color: var(--brand);
      color: var(--brand);
    }

    .btn-outline-primary:hover {
      background: var(--brand);
      color: #fff;
    }

    .popup-link {
      color: var(--brand);
      cursor: pointer;
      font-weight: 600;
    }

    .popup-link:hover {
      text-decoration: underline;
    }

    .decision-callout {
      background: var(--callout-bg);
      border: 1px solid var(--callout-border);
      border-left: 6px solid var(--callout-accent);
      border-radius: 12px;
      padding: 12px 14px;
    }

    .decision-callout .title {
      font-weight: 700;
    }

    .decision-callout .hint {
      color: var(--callout-ink);
      font-size: .9rem;
    }

    .ext-indicator {
      font-size: .8em;
      color: var(--brand-ink);
      font-weight: 600;
      margin-left: .15em
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0
    }

    .step-link-btn {
      width: 42px;
      height: 42px;
      border-radius: 9999px;
      border: 1px solid var(--line);
      background: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .step-link-btn:hover {
      background: #f5f7ff;
      border-color: #ccd6ff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .06);
    }

    .step-link-btn[disabled] {
      opacity: .45;
      cursor: not-allowed;
    }

    .step-link-icon {
      width: 22px;
      height: 22px;
    }
  </style>
</head>

<body>
  <div class="app container-fluid">
    <div class="header-card mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div class="d-flex align-items-center gap-3">
        <span class="badge badge-dst rounded-pill px-3 py-2">DST</span>
        <div>
          <h1 class="h4 mb-0">Paediatric Splenic Trauma — Decision Support System</h1>
          <div class="muted">Step by step guide</div>
        </div>
      </div>
      <div class="d-flex gap-2">
        <button id="btn-reset" class="btn btn-outline-secondary btn-sm">Reset</button>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-lg-8">
        <div id="step-container"></div>
      </div>
      <div class="col-lg-4">
        <div class="sidebar-card p-3 mb-3">
          <h5 class="mb-0">Pathway log</h5>
          <div id="audit-render" class="mt-2">
            <div class="muted">Started · Session initialised</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalPopup" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBody"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function iconConsultingSVG() {
      return '<svg class="step-link-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">\
        <path d="M12 13c-4.418 0-8-2.686-8-6s3.582-6 8-6 8 2.686 8 6c0 1.88-.97 3.555-2.548 4.72L18 15l-3.28-1.64C13.84 13.79 12.95 14 12 14" stroke="#0a66ff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\
        <circle cx="8.5" cy="7" r=".9" fill="#0a66ff"/><circle cx="12" cy="7" r=".9" fill="#0a66ff"/><circle cx="15.5" cy="7" r=".9" fill="#0a66ff"/>\
        <circle cx="6" cy="19" r="3" stroke="#0a66ff" stroke-width="1.5"/>\
        <path d="M6 16.5c1.5 0 3 .9 3 2.2V21H3v-2.3c0-1.3 1.5-2.2 3-2.2Z" fill="#e8f0ff" stroke="#0a66ff" stroke-width="1.5" stroke-linejoin="round"/>\
      </svg>';
    }

    const RULES = {
      resources: {
        stepExternal: {
          start: 'https://www.google.com',
          prepare: 'https://www.google.com',
          primary: 'https://www.google.com',
          lsi: 'https://www.google.com',
          provide_lsi: 'https://www.google.com',
          secondary: 'https://www.google.com',
          ct_criteria: 'https://www.google.com',
          ct_avail: 'https://www.google.com',
          ct_scan: 'https://www.google.com',
          lvl1: 'https://www.google.com',
          lvl2: 'https://www.google.com',
          lvl3: 'https://www.google.com',
          cap_lvl3: 'https://www.google.com',
          inpatient_icu: 'https://www.google.com',
          inpatient_ward: 'https://www.google.com',
          transfer: 'https://www.google.com',
          discharge: 'https://www.google.com'
        },
        popups: {
          alertstaff: { title: 'Alert relevant staff', body: '<ul><li>Senior emergency department medical and nursing staff</li><li>senior consultant in surgery</li><li>operating theatre staff, if available</li><li>interventional radiologists, if available</li><li>radiology staff</li><li>Senior nursing adminsitration.</li></ul>' },
          traumasupport: { title: 'Trauma system support early', body: '<ul><li>LHD Virtual care</li><li>LHD regional trauma service</li><li>NETS</li><li>NSW Aeromedical control </li></ul>' },
          zero_point: { title: 'Zero point survey', body: '<p>LINK: <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC6166036/" target="_blank" rel="noopener" title="Opens in a new tab">Zero Point Survey</a></p><p>LINK: <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC6166036/figure/f1-ceem-17-269/" target="_blank" rel="noopener" title="Opens in a new tab">Zero Point Survey (Flowchart)</a></p>' },
          splenic_signs: { title: 'Suspicion / signs of splenic injury', body: '<ul><li>LUQ pain/tenderness</li><li>Kehr sign</li><li>Hypotension/tachycardia</li><li>Distension/guarding</li></ul>' },
          haemo_categories: { title: 'Haemodynamic categories', body: '<p>Stable · Transient responder · Unstable.</p>' }
        }
      },
      steps: [
        {
          id: 'start', title: 'Child 0–16 with abdominal injury and suspected splenic trauma', instruction: 'The management of paediatric splenic injury: quick reference guide is an education tool and a practical guide to support clinicians managing a child or young person up to age 16 who is suspected of having a splenic injury.', description: `
            <p>This guide is intended for all healthcare workers who provide clinical care to children and young people who may have a splenic injury. It may be used wherever they may present or be transferred to in NSW and is particularly designed for clinicians working in regional or rural settings and/or clinicians who do not regularly manage injured children.</p>
            <p>This quick reference guide is not intended to replace senior clinical decision-making. Any concerns should be escalated locally, and/or through communication channels recommended in the guideline.  It does not represent a systematic review of evidence; however, it provides links to various established clinical resources and high-level evidence where relevant.</p>
            <p>Not all content mentioned in this resource is necessarily within a clinician’s scope of practice.</p>
            <div class='alert alert-warning my-2'><strong>⚠️ All clinicians should work within their scope of practice.</strong></div>
            <h6 class='mt-2'>DISCLAIMER</h6>
            <p>These guidelines have been produced to guide clinical decision making for the medical, nursing and allied health staff of Perth Children's Hospital. They are not strict protocols, and they do not replace the judgement of a senior clinician. Clinical common-sense should be applied at all times. These clinical guidelines should never be relied on as a substitute for proper assessment with respect to the particular circumstances of each case and the needs of each patient. Clinicians should also consider the local skill level available and their local area policies before following any guideline. </p>
            <p>Call for help early, click on this button on top</p>
          `, buttons: [{ label: 'Start', next: 'prepare' }]
        },

        {
          id: 'prepare', title: 'PREPARE', instruction: 'GOAL: Be prepared as possible before the child arrives  (Sometimes this is not possible as the child is brought in, unannounced)', description: `
            <ul>
              <li>Establish who is in your local trauma team and let them know the patient is coming or has arrived</li>
              <li>If your information is that the child is potentially unstable, <span class='popup-link' data-popup='alertstaff'>alert relevant staff</span></li>
              <li>If you don’t have trauma, surgical or paediatric capacity at your hospital, <span class='popup-link' data-popup='traumasupport'>call for trauma system support early</span></li>
              <li>Prepare for the child’s arrival – e.g., use a <span class='popup-link' data-popup='zero_point'>Zero point survey</span></li>
              <li>Prepare yourself, for example, use the I’m safe check list and mentally prepare</li>
              <li>Optimise your environment</li>
              <li>Check equipment</li>
              <li>Brief the team and delegate roles and responsibilities</li>
              <li>Apply Personal Protective Equipment</li>
            </ul>`, buttons: [{ label: 'Next', next: 'primary' }]
        },

        {
          id: 'primary', title: 'Primary survey, Resuscitation and seek advice', instruction: 'Initial assessment of a seriously injured child follows the same structured approach as that used in adults. Communicate early with retrieval services to obtain management support and determine if, when and how transfer will be required', description: `
            <ul>
              <li>Identify and treat immediately life-threatening injuries (primary survey)</li>
              <li>Initiate and optimise resuscitation</li>
              <li>Frequent reassessment is essential</li>
              <li>Consider implications of associated life-threatening injuries</li>
              <li>Initiate and optimise resuscitation Links 1a and Links 1b</li>
            </ul>
            <div class='decision-callout mt-3'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Critical branch</span></div>
              <div class='mb-2'>Is there a life threatening emergency?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='lsi'>Yes</button>
                <button class='btn btn-outline-primary' data-next='secondary'>No</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'lsi', title: 'Life Threatening Emergency', instruction: 'Life Threatening Emergency Content.', description: `
          <p>Life Saving Intervention Content</p>
          <div class='decision-callout mt-3'>
            <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'>
              <span class='title'>Decision point</span>
              <span class='hint'>Urgent intervention?</span>
            </div>
            <div class='mb-2'>Is it possible to provide life-saving urgent intervention: damage control surgery or IR (if surgical/anaesthetic capacity and capability)?</div>
            <div class='d-flex gap-2 flex-wrap'>
              <button class='btn btn-primary' data-next='provide_lsi'>Yes</button>
              <button class='btn btn-outline-primary' data-next='transfer'>No</button>
            </div>
          </div>
        `, buttons: []
        },

        {
          id: 'provide_lsi', title: 'Provide Life Saving Intervention', instruction: 'Life Saving Intervention Content.', description: `
          <div class='decision-callout mt-3'>
            <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'>
              <span class='title'>Decision point</span>
              <span class='hint'>Capacity & capability</span>
            </div>
            <div class='mb-2'>Is there Capacity to admit the child (RCT, ATC, PTC)?</div>
            <div class='d-flex gap-2 flex-wrap'>
              <button class='btn btn-primary' data-next='inpatient_icu'>Yes</button>
              <button class='btn btn-outline-primary' data-next='transfer'>No</button>
            </div>
          </div>
        `, buttons: []
        },

        {
          id: 'secondary', title: 'Secondary survey and characterisation of the splenic injury', instruction: 'Placeholder text : Some content to show here', description: `
            <ul>
              <li>Secondary  survey (link)</li>
              <li><span class='popup-link' data-popup='splenic_signs'>Suspicion of intra-abdominal injury, Signs of splenic injury</span></li>
              <li><span class='popup-link' data-popup='haemo_categories'>Haemodynamic categories</span></li>
            </ul>
            <div class='decision-callout mt-3'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Critical branch</span></div>
              <div class='mb-2'>Is the child requiring ongoing resuscitation thus not stable for CT?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='lsi'>Yes, the child requires ongoing resuscitation</button>
                <button class='btn btn-outline-primary' data-next='ct_criteria'>No, the child is stable for CT scan</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'ct_criteria', title: 'CT Scan Criteria', instruction: 'CT Scan criteria content.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Criteria check</span></div>
              <div class='mb-2'>Does the child meet CT scan criteria?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='ct_avail'>Yes — meets criteria</button>
                <button class='btn btn-outline-primary' data-next='ct_criteria'>No — does not meet criteria</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'ct_avail', title: 'Availability of CT Scan', instruction: 'Is CT scan available for a child/young person of this age?', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Resource check</span></div>
              <div class='mb-2'>Is CT scan available?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='ct_scan'>Yes — CT available</button>
                <button class='btn btn-outline-primary' data-next='transfer'>No — arrange transfer</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'ct_scan', title: 'CT Scan', instruction: 'CT Scan Section Content.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Injury grading</span></div>
              <div class='mb-2'>Is this a confirmed splenic injury, and what is the grade of injury?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='lvl1'>Level 1</button>
                <button class='btn btn-outline-primary' data-next='lvl2'>Level 2</button>
                <button class='btn btn-outline-primary' data-next='lvl3'>Level 3</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'lvl1', title: 'Level 1', instruction: 'Level 1 Content.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Local capacity</span></div>
              <div class='mb-2'>Is there capacity and capability to admit a child/young person of this age?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='inpatient_ward'>Yes</button>
                <button class='btn btn-outline-primary' data-next='transfer'>No</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'lvl2', title: 'Level 2', instruction: 'Level 2 Content.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Local capacity</span></div>
              <div class='mb-2'>Is there capacity and capability to admit a child/young person of this age?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='inpatient_icu'>Yes</button>
                <button class='btn btn-outline-primary' data-next='transfer'>No</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'lvl3', title: 'Level 3', instruction: 'Content — Require ongoing resuscitation.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Emergency check</span></div>
              <div class='mb-2'>Is there a life‑threatening emergency?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='lsi'>Yes</button>
                <button class='btn btn-outline-primary' data-next='cap_lvl3'>No</button>
              </div>
            </div>`, buttons: []
        },

        {
          id: 'cap_lvl3', title: 'Capacity for Level 3', instruction: 'Capacity for Level 3 content.', description: `
            <div class='decision-callout mt-1'>
              <div class='d-flex align-items-center justify-content-between flex-wrap gap-2 mb-1'><span class='title'>Decision point</span><span class='hint'>Local capacity</span></div>
              <div class='mb-2'>Is there capacity and capability to admit a child/young person of this age?</div>
              <div class='d-flex gap-2 flex-wrap'>
                <button class='btn btn-primary' data-next='inpatient_icu'>Yes</button>
                <button class='btn btn-outline-primary' data-next='transfer'>No</button>
              </div>
            </div>`, buttons: []
        },

        { id: 'inpatient_icu', title: 'Inpatient pathway: ICU/HDU care; possible intervention', instruction: 'Inpatient pathway: ICU/HDU care; possible intervention content.', buttons: [{ label: 'Next — Inpatient pathway ward based', next: 'inpatient_ward' }] },
        { id: 'inpatient_ward', title: 'Inpatient pathway — ward based', instruction: 'Inpatient pathway — ward based content.', buttons: [{ label: 'Next — Discharge', next: 'discharge' }] },
        { id: 'transfer', title: 'Transfer', instruction: 'Transfer content.', buttons: [{ label: 'End', next: '__reset__' }] },
        { id: 'discharge', title: 'Discharge', instruction: 'Discharge content.', buttons: [{ label: 'End', next: '__reset__' }] }
      ]
    };

    const $ = (s, r = document) => r.querySelector(s); const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
    const state = { currentId: 'start', audit: [], history: [] };

    function stepById(id) { return RULES.steps.find(s => s.id === id); }

    function enhanceExternalLinks(root) {
      if (!root) return; const anchors = root.querySelectorAll('a[href^="http"], a[target="_blank"]');
      anchors.forEach(a => { if (a.dataset.enhanced === '1') return; a.setAttribute('target', '_blank'); a.setAttribute('rel', 'noopener'); if (!a.getAttribute('title')) a.setAttribute('title', 'Opens in a new tab'); a.setAttribute('data-bs-toggle', 'tooltip'); const sr = document.createElement('span'); sr.className = 'sr-only'; sr.textContent = ' (opens in a new tab, external link)'; const sup = document.createElement('sup'); sup.className = 'ext-indicator'; sup.setAttribute('aria-hidden', 'true'); sup.textContent = '↗'; a.appendChild(sr); a.appendChild(sup); a.dataset.enhanced = '1'; a.addEventListener('click', () => { pushAudit(stepById(state.currentId).title, 'Opened external link: ' + (a.innerText || 'link')); }); }); if (window.bootstrap && window.bootstrap.Tooltip) { [...root.querySelectorAll('a[data-bs-toggle="tooltip"]')].forEach(el => { try { new window.bootstrap.Tooltip(el); } catch (e) { } }); }
    }

    function renderStep() {
      const s = stepById(state.currentId) || stepById('start');
      const extURL = RULES.resources.stepExternal[s.id];
      const hasURL = !!(extURL && typeof extURL === 'string' && extURL.trim() && extURL !== '#');
      const toolTip = hasURL ? 'Open step guidance' : 'No link available';
      const btnsData = [...(s.buttons || []), ...(s.id !== 'start' ? [{ label: 'Back', next: '__back__' }] : [])];
      const btnsHTML = btnsData.map(b => `<button class="btn ${String(b.label).toLowerCase().includes('back') ? 'btn-outline-secondary' : 'btn-primary'} me-2" data-next="${b.next}">${b.label}</button>`).join('');

      $('#step-container').innerHTML = `<div class='card-step p-3 p-md-4'>
        <div class='step-card-header mb-2'>
          <h2 class='h5 mb-0'>${s.title}</h2>
          <button class='step-link-btn' ${hasURL ? '' : 'disabled'} data-step-link='${hasURL ? extURL : ''}' aria-label='Open guidance for ${s.title}' data-bs-toggle='tooltip' data-bs-placement='left' title='${toolTip}'>${iconConsultingSVG()}</button>
        </div>
        <div class='alert alert-instruction mb-2'>${s.instruction}</div>
        ${s.description ? `<div class='mt-2'>${s.description}</div>` : ''}
        <div class='d-flex justify-content-end mt-4'>${btnsHTML}</div>
      </div>`;

      const tipBtn = $('#step-container .step-link-btn');
      if (tipBtn && window.bootstrap && window.bootstrap.Tooltip) { new window.bootstrap.Tooltip(tipBtn); }
      if (hasURL && tipBtn) { tipBtn.addEventListener('click', () => { pushAudit(s.title, 'Opened guidance'); window.open(extURL, '_blank', 'noopener'); }); }

      $$('#step-container [data-next]').forEach(b => b.addEventListener('click', () => {
        const nxt = b.getAttribute('data-next'); const label = b.textContent; if (!nxt) return;
        if (nxt === '__reset__') { pushAudit(s.title, label); state.audit = []; state.history = []; state.currentId = 'start'; renderStep(); renderAudit(); return; }
        if (nxt === '__back__') { pushAudit(s.title, 'Back'); const prev = state.history.pop(); state.currentId = prev || 'start'; renderStep(); renderAudit(); return; }
        pushAudit(s.title, label); state.history.push(state.currentId); state.currentId = nxt; renderStep(); renderAudit();
      }));

      $$('#step-container [data-popup]').forEach(el => el.addEventListener('click', () => openPopup(el.getAttribute('data-popup'))));
      enhanceExternalLinks($('#step-container'));
    }

    function openPopup(key) {
      const p = RULES.resources.popups[key]; if (!p) return; $('#modalTitle').textContent = p.title; $('#modalBody').innerHTML = p.body; const modalEl = document.getElementById('modalPopup'); if (window.bootstrap && window.bootstrap.Modal && modalEl) { window.bootstrap.Modal.getOrCreateInstance(modalEl).show(); } setTimeout(() => enhanceExternalLinks($('#modalBody')), 0);
    }

    function pushAudit(t, l) { state.audit.push({ stepId: state.currentId, title: t, label: l, ts: Date.now() }); renderAudit(); }
    function renderAudit() { $('#audit-render').innerHTML = state.audit.map(e => `<div>${e.title} – <span class='muted'>${e.label}</span></div>`).join('') || '<div class="muted">Started · Session initialised</div>'; }

    function init() { try { renderStep(); } catch (e) { const c = document.getElementById('step-container'); if (c) { c.innerHTML = `<div class='alert alert-danger'>Init error: ${e.message || e}</div>`; } } }
    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }

    const resetBtn = document.getElementById('btn-reset'); if (resetBtn) { resetBtn.addEventListener('click', () => { state.audit = []; state.history = []; state.currentId = 'start'; renderStep(); renderAudit(); }); }
  </script>
</body>

</html>